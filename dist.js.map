{"version":3,"sources":["webpack:///webpack/bootstrap f9ad2db75efae555a653","webpack:///./src/module.ts","webpack:///./src/service.ts","webpack:///./src/utils.ts","webpack:///./src/factory.ts"],"names":[],"mappings":"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","file":"dist.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap f9ad2db75efae555a653\n **/","/**\n * @author Erik Norgren <erik.norgren@interactivesolutions.se>\n *     \n * @copyright Interactive Solutions\n */\n\nimport {AuthenticationService, AuthenticationStorage} from \"./service\";\nimport {HttpAuthorizationInjector, HttpRefreshTokenInjector} from \"./factory\";\n\nmodule interactivesolutions.authentication\n{\n  angular\n    .module('interactivesolutions.authentication', [])\n\n    // Services\n    .service('authenticationService', AuthenticationService)\n    .service('authenticationStorage', AuthenticationStorage)\n\n    // Factories\n    .factory('httpAuthorizationInjector', HttpAuthorizationInjector)\n    .factory('httpRefreshTokenInjector', HttpRefreshTokenInjector)\n\n    .config(function ($httpProvider: ng.IHttpProvider) {\n\n      $httpProvider.interceptors.push('httpAuthorizationInjector');\n      $httpProvider.interceptors.push('httpRefreshTokenInjector');\n    })\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/module.ts\n **/","/**\n * @author    Antoine Hedgecock <antoine.hedgecock@gmail.com>\n *\n * @copyright Interactive Solutions AB\n */\n\nimport {QueryString} from \"./utils\";\nimport {EventManager} from \"interactivesolutions-event-manager\";\n\n/**\n * Simple data container for the access token\n */\nexport class AccessToken {\n  constructor(private accessToken:string,\n              private ownerId:any,\n              private expiresAt:number,\n              private refreshToken:string,\n              private tokenType:string) {\n\n  }\n\n  getAccessToken():string {\n    return this.accessToken;\n  }\n\n  getOwnerId():any {\n    return this.ownerId;\n  }\n\n  getExpiresAt():number {\n    return this.expiresAt;\n  }\n\n  getRefreshToken():string {\n    return this.refreshToken;\n  }\n\n  getTokenType():string {\n    return this.tokenType;\n  }\n}\n\nexport class AuthenticationStorage {\n\n  private accessToken:AccessToken = null;\n\n  constructor() {\n    this.fromLocalStorage();\n  }\n\n  write(accessToken:AccessToken) {\n    localStorage.setItem('auth: accessToken', accessToken.getAccessToken());\n    localStorage.setItem('auth: ownerId', accessToken.getOwnerId());\n    localStorage.setItem('auth: refreshToken', accessToken.getRefreshToken());\n    localStorage.setItem('auth: expiresAt', accessToken.getExpiresAt().toString());\n    localStorage.setItem('auth: tokenType', accessToken.getTokenType());\n\n    this.accessToken = accessToken;\n  }\n\n  read():AccessToken {\n    return this.accessToken;\n  }\n\n  clear():void {\n    this.accessToken = null;\n\n    localStorage.removeItem('auth: accessToken');\n    localStorage.removeItem('auth: refreshToken');\n    localStorage.removeItem('auth: ownerId');\n    localStorage.removeItem('auth: expiresAt');\n    localStorage.removeItem('auth: tokenType');\n  }\n\n  hasAccessToken():boolean {\n    return this.accessToken !== null;\n  }\n\n  private fromLocalStorage():void {\n    var accessToken = localStorage.getItem('auth: accessToken');\n    var ownerId = localStorage.getItem('auth: ownerId');\n    var refreshToken = localStorage.getItem('auth: refreshToken');\n    var expiresAt = localStorage.getItem('auth: expiresAt');\n    var tokenType = localStorage.getItem('auth: tokenType');\n\n    if (accessToken === null || refreshToken === null) {\n      return;\n    }\n\n    this.accessToken = new AccessToken(accessToken, ownerId, expiresAt, refreshToken, tokenType);\n  }\n}\n\nexport class AuthenticationService extends EventManager {\n\n  private http:ng.IHttpService;\n  private storage:AuthenticationStorage;\n\n  private refreshPromise:ng.IPromise<void> = null;\n\n  /**\n   * @param $http\n   * @param authenticationStorage\n   */\n  constructor($http:ng.IHttpService, authenticationStorage:AuthenticationStorage) {\n    super();\n\n    this.http = $http;\n    this.storage = authenticationStorage;\n  }\n\n  /**\n   * Authenticate\n   *\n   * @param parameters\n   *\n   * @returns {IPromise<void>}\n   */\n  login(parameters:any):ng.IPromise<void> {\n\n    var queryString = QueryString.stringify(parameters);\n\n    return this.http({\n      method: 'POST',\n      url: '/oauth/token',\n      headers: {'Content-Type': 'application/x-www-form-urlencoded'},\n      data: queryString\n    }).then((response:ng.IHttpPromiseCallbackArg<any>) => {\n\n      // Time is returned in ms.\n      var now = new Date().getTime() / 1000;\n\n      var accessToken = new AccessToken(\n        response.data.access_token,\n        response.data.owner_id,\n        response.data.expires_in + now,\n        response.data.refresh_token,\n        response.data.token_type\n      );\n\n      // Persist it\n      this.storage.write(accessToken);\n\n      // Trigger a auth event\n      this.emit('authentication-changed', this);\n    });\n  }\n\n  /**\n   * Use the refresh token to generate a new access token\n   *\n   * @returns {IPromise<void>}\n   */\n  refresh():ng.IPromise<void> {\n\n    if (this.refreshPromise) {\n      return this.refreshPromise;\n    }\n\n    var queryString = QueryString.stringify({\n      grant_type: 'refresh_token',\n      refresh_token: this.storage.read().getRefreshToken()\n    });\n\n    this.refreshPromise = this\n      .http({\n        method: 'POST',\n        url: '/oauth/token',\n        headers: {'Content-Type': 'application/x-www-form-urlencoded'},\n        data: queryString\n      })\n      .then((response:ng.IHttpPromiseCallbackArg<any>) => {\n\n        // Time is returned in ms.\n        var now = new Date().getTime() / 1000;\n\n        var accessToken = new AccessToken(\n          response.data.access_token,\n          response.data.owner_id,\n          response.data.expires_in + now,\n          response.data.refresh_token,\n          response.data.token_type\n        );\n\n        // Persist it\n        this.storage.write(accessToken);\n      })\n      .catch(() => {\n        this.storage.clear();\n        this.emit('authentication-changed', this);\n      })\n      .finally(() => this.refreshPromise = null);\n\n    return this.refreshPromise;\n  }\n\n  /**\n   * Check if the current user is authenticated, does not test if it's still valid tho.\n   *\n   * @returns {boolean}\n   */\n  isAuthenticated():boolean {\n    var now:number = new Date().getTime() / 1000;\n    var token:AccessToken = this.storage.read();\n\n    if (!token) {\n      return false;\n    }\n\n    return token.getExpiresAt() >= now;\n  }\n\n  /**\n   * Remove the oauth token and trigger a auth event\n   */\n  logout():void {\n\n    // Delete the oauth token\n    this.storage.clear();\n\n    // Trigger a auth event\n    this.emit('authentication-changed', this);\n  }\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/service.ts\n **/","/**\n * @author Erik Norgren <erik.norgren@interactivesolutions.se>\n *   \n * @copyright Interactive Solutions\n */\n\n/**\n * Utility query string class\n */\nexport class QueryString {\n\n  /**\n   * Creates a query string from an object\n   *\n   * @param obj\n   * @returns {string}\n   */\n  public static stringify(obj:any):string {\n\n    var queryString:string = obj ? Object.keys(obj).sort().map(function (key) {\n      var val = obj[key];\n\n      if (val === '' || val === undefined) {\n        return;\n      }\n\n      if (Array.isArray(val)) {\n        return val.sort().map(function (val2) {\n          return encodeURIComponent(key) + '=' + encodeURIComponent(val2);\n        }).join('&');\n      }\n\n      return encodeURIComponent(key) + '=' + encodeURIComponent(val);\n    }).join('&') : '';\n\n    var regExp = new RegExp('&+');\n\n    queryString = queryString.replace(regExp, '&');\n\n    if (queryString.charAt(0) === '&') {\n      queryString = queryString.substr(1);\n    }\n\n    return queryString;\n  }\n\n  public static parse():string|boolean {\n    var queryString:any = {};\n    var href:string = window.location.href;\n\n    var query:string = href.split('?')[1];\n\n    if (!query) {\n      return false;\n    }\n\n    var vars:string[] = query.split('&');\n\n    for (var i = 0; i < vars.length; i++) {\n      var pair = vars[i].split('=');\n\n      if (typeof queryString[pair[0]] === 'undefined') {\n        queryString[pair[0]] = decodeURIComponent(pair[1]);\n      } else if (typeof queryString[pair[0]] === 'string') {\n        queryString[pair[0]] = [queryString[pair[0]], decodeURIComponent(pair[1])];\n      } else {\n        queryString[pair[0]].push(decodeURIComponent(pair[1]));\n      }\n    }\n\n    return queryString;\n  }\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/utils.ts\n **/","/**\n * @author    Antoine Hedgecock <antoine.hedgecock@gmail.com>\n *\n * @copyright Interactive Solutions AB\n */\n\nimport {AuthenticationStorage, AuthenticationService} from \"./service\";\n\ninterface IsRequestConfig extends ng.IRequestConfig {\n  disableAuthorizationHeader?:boolean;\n}\n\nexport function HttpAuthorizationInjector(authenticationStorage: AuthenticationStorage) {\n  return {\n    request: function (request: IsRequestConfig) {\n      if (request.url.indexOf('/oauth/token') !== -1) {\n        return request;\n      }\n\n      var token = authenticationStorage.read();\n      if (token && !request.disableAuthorizationHeader) {\n        request.headers['Authorization'] = 'Bearer ' + token.getAccessToken();\n      }\n\n      return request;\n    }\n  };\n}\n\nexport function HttpRefreshTokenInjector(loginStateName: string, $q: ng.IQService, $injector: any) {\n\n  return {\n    responseError: function (response: ng.IHttpPromiseCallbackArg<any>) {\n\n      var httpService: ng.IHttpService = $injector.get('$http');\n      var authService: AuthenticationService = $injector.get('authenticationService');\n      var authStorage: AuthenticationStorage = $injector.get('authenticationStorage');\n      var stateService: ng.ui.IStateService = $injector.get('$state');\n\n      if (response.status === 401) {\n\n        if (authStorage.hasAccessToken()) {\n\n          return authService\n            .refresh()\n            .then(() => httpService(response.config))\n            .catch(() => authStorage.clear());\n\n        } else {\n          stateService.go(loginStateName);\n        }\n      }\n\n      return $q.reject(response);\n    }\n  };\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/factory.ts\n **/"],"sourceRoot":""}